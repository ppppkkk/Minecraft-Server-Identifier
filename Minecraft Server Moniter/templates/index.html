<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MC Monitor | Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.3.0/build/global/luxon.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.3.1/dist/chartjs-adapter-luxon.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-streaming@2.0.0/dist/chartjs-plugin-streaming.min.js"></script>
    <style>
        body { background: #0f172a; color: white; font-family: 'Inter', sans-serif; }
        
        /* High Contrast Stat Cards */
        .card { background: #1e293b; border: 2px solid #334155; border-radius: 15px; }
        .stat-label { font-size: 0.9rem; font-weight: 800; color: #94a3b8; text-transform: uppercase; letter-spacing: 1px; }
        
        /* Updated Colors for Visibility */
        .ping-value { font-size: 3.5rem; font-weight: 900; color: #adff2f; text-shadow: 0 0 20px rgba(173, 255, 47, 0.3); }
        .player-value { font-size: 3.5rem; font-weight: 900; color: #fb923c; text-shadow: 0 0 20px rgba(251, 146, 60, 0.3); }
        
        /* Terminal Styling */
        #console-log { background: #000; color: #10b981; font-family: 'Courier New', monospace; font-size: 0.85rem; height: 180px; overflow-y: auto; border-radius: 0 0 10px 10px; border: 1px solid #334155; border-top: none; }
        .terminal-header { background: #334155; padding: 8px 15px; border-radius: 10px 10px 0 0; font-size: 0.8rem; color: #cbd5e1; border: 1px solid #334155; }
        
        .btn-clear { font-size: 0.7rem; padding: 2px 8px; color: #cbd5e1; border: 1px solid #475569; background: transparent; }
        .btn-clear:hover { background: #ef4444; color: white; }
    </style>
</head>
<body>
    <div class="container py-4">
        <a href="/" class="btn btn-outline-info btn-sm mb-4">‚Üê Back to Search</a>
        
        <h2 class="mb-4 text-center">Monitoring: <span class="text-info">{{ ip }}</span></h2>

        <div class="row g-4 mb-4">
            <div class="col-md-6 text-center">
                <div class="card p-4">
                    <div class="stat-label">Current Latency</div>
                    <div id="ping-text" class="ping-value">--</div>
                    <div class="text-muted">ms delay</div>
                </div>
            </div>
            <div class="col-md-6 text-center">
                <div class="card p-4">
                    <div class="stat-label">Current Players</div>
                    <div id="player-text" class="player-value">--</div>
                    <div class="text-muted">active online</div>
                </div>
            </div>
        </div>

        <div class="card p-4 mb-4">
            <canvas id="liveChart" height="100"></canvas>
        </div>

        <div class="terminal-header d-flex justify-content-between align-items-center">
            <span>SYSTEM CONSOLE LOG</span>
            <button class="btn btn-clear" onclick="clearConsole()">CLEAR LOG</button>
        </div>
        <div id="console-log" class="p-3">
            <div>> Handshake initiated...</div>
        </div>
    </div>

    <script>
        const ctx = document.getElementById('liveChart').getContext('2d');
        const consoleLog = document.getElementById('console-log');

        const chart = new Chart(ctx, {
            type: 'line',
            data: {
                datasets: [
                    {
                        label: 'Ping (ms)',
                        borderColor: '#adff2f',
                        backgroundColor: 'rgba(173, 255, 47, 0.1)',
                        borderWidth: 3,
                        tension: 0.3,
                        data: [],
                        yAxisID: 'y'
                    },
                    {
                        label: 'Players',
                        borderColor: '#fb923c',
                        backgroundColor: 'rgba(251, 146, 60, 0.1)',
                        borderWidth: 3,
                        tension: 0.3,
                        data: [],
                        yAxisID: 'y1'
                    }
                ]
            },
            options: {
                responsive: true,
                scales: {
                    x: { type: 'realtime', realtime: { delay: 2000, duration: 20000 } },
                    y: { type: 'linear', position: 'left', title: { display: true, text: 'Latency (ms)', color: '#adff2f' } },
                    y1: { type: 'linear', position: 'right', grid: { drawOnChartArea: false }, title: { display: true, text: 'Player Count', color: '#fb923c' } }
                }
            }
        });

        function updateData() {
            fetch('/data')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('ping-text').innerText = data.mc_ping;
                    document.getElementById('player-text').innerText = data.players;

                    chart.data.datasets[0].data.push({ x: Date.now(), y: data.mc_ping });
                    chart.data.datasets[1].data.push({ x: Date.now(), y: data.players });

                    const time = new Date().toLocaleTimeString();
                    const entry = document.createElement('div');
                    
                    if (data.status === "Online") {
                        entry.innerHTML = `[${time}] <span style="color: #adff2f">SUCCESS:</span> Latency ${data.mc_ping}ms | Players ${data.players}`;
                    } else {
                        entry.innerHTML = `[${time}] <span style="color: #f87171">TIMEOUT:</span> Server connection failed.`;
                    }

                    consoleLog.appendChild(entry);
                    consoleLog.scrollTop = consoleLog.scrollHeight;

                    while (consoleLog.childNodes.length > 25) {
                        consoleLog.removeChild(consoleLog.firstChild);
                    }
                });
        }

        function clearConsole() {
            consoleLog.innerHTML = '<div>> Console cleared.</div>';
        }

        setInterval(updateData, 3000);
    </script>
</body>
</html>
